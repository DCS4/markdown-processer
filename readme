# Markdownæ–‡æ¡£å¤„ç†æœåŠ¡

åŸºäºFastAPIçš„æ ¼å¼æ„ŸçŸ¥Markdownæ–‡æ¡£å¤„ç†æœåŠ¡ï¼Œé›†æˆT5æ–‡æœ¬çº é”™å’ŒPresidioéšç§è„±æ•åŠŸèƒ½ï¼Œä¸“ä¸ºDifyå·¥ä½œæµè®¾è®¡ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **æ ¼å¼æ„ŸçŸ¥å¤„ç†**: ä½¿ç”¨markdown-itè§£æå™¨ï¼Œç¡®ä¿æ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç å—ç­‰æ ¼å¼ä¸è¢«ç ´å
- **æ™ºèƒ½æ–‡æœ¬çº é”™**: é›†æˆT5æ¨¡å‹ï¼Œä»…å¯¹çº¯æ–‡æœ¬æ®µè½è¿›è¡Œçº é”™
- **éšç§ä¿¡æ¯è„±æ•**: ä½¿ç”¨Presidioè‡ªåŠ¨è¯†åˆ«å’Œè„±æ•å§“åã€ç”µè¯ã€é‚®ç®±ç­‰æ•æ„Ÿä¿¡æ¯
- **åŠ¨æ€æ–‡æœ¬åˆ†å‰²**: æ ¹æ®æ–‡æ¡£é•¿åº¦æ™ºèƒ½å†³å®šæ˜¯å¦åˆ†å—å¤„ç†
- **å¼‚æ­¥å¤„ç†æ”¯æŒ**: æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥ä¸¤ç§å¤„ç†æ¨¡å¼
- **Difyå‹å¥½æ¥å£**: ä¸“é—¨ä¼˜åŒ–çš„APIæ¥å£ï¼Œä¾¿äºé›†æˆåˆ°Difyå·¥ä½œæµ
- **Dockeréƒ¨ç½²**: æä¾›å®Œæ•´çš„Dockeréƒ¨ç½²æ–¹æ¡ˆ

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
PDFæ–‡æ¡£ â†’ MinerUè½¬æ¢ â†’ Markdownå¤„ç†æœåŠ¡ â†’ åˆ†å—ç»“æœ â†’ åç»­æµç¨‹
                     â†“
               [æ ¼å¼è§£æ] â†’ [æ–‡æœ¬æå–] â†’ [T5çº é”™] â†’ [éšç§è„±æ•] â†’ [é‡ç»„è¾“å‡º]
```

## ğŸ“‹ APIæ¥å£

### å¥åº·æ£€æŸ¥
```http
GET /health
```

### åŒæ­¥å¤„ç†ï¼ˆæ¨èç”¨äºDifyï¼‰
```http
POST /dify/process
Content-Type: application/json

{
  "markdown_content": "# æ ‡é¢˜\nå†…å®¹...",
  "config": {
    "no_split_threshold": 8000,
    "chunk_size": 7000,
    "chunk_overlap": 500
  }
}
```

### å¼‚æ­¥å¤„ç†ï¼ˆé€‚åˆå¤§æ–‡ä»¶ï¼‰
```http
POST /process-async
Content-Type: application/json

{
  "markdown_content": "# æ ‡é¢˜\nå†…å®¹...",
  "config": {...}
}
```

### æŸ¥è¯¢ä»»åŠ¡çŠ¶æ€
```http
GET /task/{task_id}
```

### æ–‡ä»¶ä¸Šä¼ 
```http
POST /upload-markdown
Content-Type: multipart/form-data

file: markdown_file.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®
```bash
git clone <é¡¹ç›®åœ°å€>
cd markdown-processor
```

### 2. é…ç½®ç¯å¢ƒ
```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# æ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®
vim .env
```

### 3. ä¸€é”®éƒ¨ç½²
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh manage.sh

# æ‰§è¡Œéƒ¨ç½²
./deploy.sh
```

### 4. éªŒè¯éƒ¨ç½²
```bash
# å¥åº·æ£€æŸ¥
curl http://localhost:8000/health

# è¿è¡Œæµ‹è¯•
./manage.sh test
```

## ğŸ› ï¸ ç®¡ç†å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
./manage.sh start

# åœæ­¢æœåŠ¡
./manage.sh stop

# é‡å¯æœåŠ¡
./manage.sh restart

# æŸ¥çœ‹çŠ¶æ€
./manage.sh status

# æŸ¥çœ‹æ—¥å¿—
./manage.sh logs

# å¥åº·æ£€æŸ¥
./manage.sh health

# æ¸…ç†æ•°æ®
./manage.sh clean

# æ›´æ–°æœåŠ¡
./manage.sh update

# å¤‡ä»½æ•°æ®
./manage.sh backup

# ç›‘æ§æœåŠ¡
./manage.sh monitor

# è¿è¡Œæµ‹è¯•
./manage.sh test
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®
```bash
# æœåŠ¡é…ç½®
DEBUG=false
LOG_LEVEL=INFO
MAX_CONCURRENT_TASKS=3

# æ¨¡å‹é…ç½®
MODEL_NAME=deepseek-7b
T5_MODEL_PATH=/app/models/t5_model
SPACY_MODEL_PATH=zh_core_web_md

# æ–‡ä»¶é…ç½®
MAX_FILE_SIZE=52428800  # 50MB
```

### å¤„ç†é…ç½®
```json
{
  "no_split_threshold": 8000,    // ä¸åˆ†å‰²é˜ˆå€¼
  "chunk_size": 7000,            // åˆ†å—å¤§å°
  "chunk_overlap": 500           // åˆ†å—é‡å 
}
```

## ğŸ”Œ Difyé›†æˆ

### HTTPèŠ‚ç‚¹é…ç½®
```json
{
  "method": "POST",
  "url": "http://markdown-processor:8000/dify/process",
  "headers": {
    "Content-Type": "application/json"
  },
  "body": {
    "markdown_content": "{{previous_node.markdown_content}}",
    "config": {
      "no_split_threshold": 8000,
      "chunk_size": 7000,
      "chunk_overlap": 500
    }
  },
  "timeout": 300
}
```

### å®Œæ•´å·¥ä½œæµç¤ºä¾‹
```
1. [æ–‡ä»¶ä¸Šä¼ ] â†’ ä¸Šä¼ PDFæ–‡ä»¶
2. [MinerUè½¬æ¢] â†’ PDFè½¬Markdown
3. [Markdownå¤„ç†] â†’ çº é”™å’Œè„±æ•
4. [å‘é‡åŒ–] â†’ ç”Ÿæˆå‘é‡
5. [å­˜å‚¨] â†’ ä¿å­˜åˆ°çŸ¥è¯†åº“
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### èµ„æºé…ç½®
- **å†…å­˜**: å»ºè®®4GBä»¥ä¸Š
- **CPU**: å»ºè®®2æ ¸ä»¥ä¸Š
- **å­˜å‚¨**: é¢„ç•™10GBç”¨äºæ¨¡å‹å’Œç¼“å­˜

### ä¼˜åŒ–å»ºè®®
1. **æ¨¡å‹é¢„åŠ è½½**: å°†æ¨¡å‹æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨ä¸­
2. **å¹¶å‘æ§åˆ¶**: æ ¹æ®èµ„æºæƒ…å†µè°ƒæ•´`MAX_CONCURRENT_TASKS`
3. **ç¼“å­˜ç­–ç•¥**: å¯¹ç›¸åŒå†…å®¹å¯ç”¨ç¼“å­˜
4. **è´Ÿè½½å‡è¡¡**: å¤šå®ä¾‹éƒ¨ç½²æ—¶ä½¿ç”¨Nginxè´Ÿè½½å‡è¡¡

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¨¡å‹ä¸‹è½½å¤±è´¥**
   ```bash
   # æ‰‹åŠ¨ä¸‹è½½spaCyæ¨¡å‹
   docker exec -it markdown-processor python -m spacy download zh_core_web_md
   ```

2. **å†…å­˜ä¸è¶³**
   ```bash
   # è°ƒæ•´Dockerå†…å­˜é™åˆ¶
   docker-compose up -d --scale markdown-processor=1
   ```

3. **å¤„ç†è¶…æ—¶**
   ```bash
   # å¢åŠ è¶…æ—¶æ—¶é—´æˆ–æ”¹ç”¨å¼‚æ­¥å¤„ç†
   curl -X POST -d '{"timeout": 600, ...}' http://localhost:8000/process-async
   ```

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
./manage.sh logs

# æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—
docker logs markdown-processor

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker exec -it markdown-processor tail -f /app/logs/app.log
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

1. **æ•æ„Ÿä¿¡æ¯**: ç¡®ä¿è„±æ•é…ç½®æ­£ç¡®
2. **æ–‡ä»¶ä¸Šä¼ **: é™åˆ¶æ–‡ä»¶å¤§å°å’Œç±»å‹
3. **ç½‘ç»œè®¿é—®**: åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨é˜²ç«å¢™
4. **æ—¥å¿—å®‰å…¨**: é¿å…åœ¨æ—¥å¿—ä¸­è®°å½•æ•æ„Ÿä¿¡æ¯

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Forké¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€Pull Request

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š
1. åˆ›å»ºIssue
2. æŸ¥çœ‹æ–‡æ¡£
3. è”ç³»ç»´æŠ¤è€…

---

**æ³¨æ„**: é¦–æ¬¡å¯åŠ¨æ—¶æ¨¡å‹ä¸‹è½½å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œè¯·è€å¿ƒç­‰å¾…ã€‚å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä¸­é¢„å…ˆä¸‹è½½æ¨¡å‹æ–‡ä»¶ã€‚